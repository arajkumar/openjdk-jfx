language: java
sudo: false

jdk: openjdk10


# Won't be able to build webkit in the time alloted by Travis

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  ccache: true
  directories:
    - $HOME/.gradle/caches/

matrix:
  fast_finish: true
  include:
    - os: linux
      dist: trusty
      addons:
        apt:
          sources:
            # for gcc 7.3
            - sourceline: 'ppa:ubuntu-toolchain-r/test'
          packages:
            - ksh
            - bison
            - flex
            - gperf
            - libasound2-dev
            - libgl1-mesa-dev
            - libgstreamer0.10-dev
            - libgstreamer-plugins-base0.10-dev
            - libjpeg-dev
            - libpng-dev
            - libx11-dev
            - libxml2-dev
            - libxslt1-dev
            - libxt-dev
            - libxxf86vm-dev
            - pkg-config
            - libavcodec-dev
            - libgtk2.0-dev
            - libgtk-3-dev
            - libxtst-dev
            - libudev-dev
            - libavformat-dev
            - gdb
            - libcups2-dev
            - gcc-7
            - g++-7
    - os: osx
      osx_image: xcode9
      # env: PRINT_CRASH_LOGS="true"

before_script:
  - echo $JAVA_OPTS
  - sh ./gradlew --version
  # run on xvfb screen (for linux).
  - if [ "${TRAVIS_OS_NAME}" == "linux" ]; then export DISPLAY=:99.0 && sh -e /etc/init.d/xvfb start; fi

before_install:
  - .ci/before_install.sh
  - if [ "${TRAVIS_OS_NAME}" == "linux" ]; then sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 60 --slave /usr/bin/g++ g++ /usr/bin/g++-7 && sudo update-alternatives --config gcc && gcc --version && g++ --version; fi
  - if [ "${TRAVIS_OS_NAME}" == "linux" ]; then readlink -f gcc && readlink -f g++; fi


# skip install stage.
install: true

script: .ci/script.sh

notifications:
  email: false

